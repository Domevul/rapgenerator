import{r as l,g as p}from"./phaser-Czz4FBZH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=s(e);fetch(e.href,r)}})();var f=l();const n=p(f),h=[{id:"A1",text:`俺のフロウは最強、ビートを支配する
お前のライムは弱小、勝負にならない`,type:"attack",rhymeScore:20,countersTo:["technical"]},{id:"A2",text:`ここは俺のステージ、お前は帰れ
実力の差を見せてやる、これが真のMC`,type:"attack",rhymeScore:25,countersTo:["technical"]},{id:"A3",text:`お前のスキルじゃ俺には勝てない
このバトルで証明する、俺がナンバーワン`,type:"attack",rhymeScore:20,countersTo:["technical"]},{id:"B1",text:`韻を踏むのは俺の専門、リズムも完璧
君のスタイルじゃこのバトル、勝利は不可能`,type:"technical",rhymeScore:30,countersTo:["counter"]},{id:"B2",text:`ワードプレイで魅せる俺のアート
メタファーとライムで編む最高のパート`,type:"technical",rhymeScore:30,countersTo:["counter"]},{id:"B3",text:`フロウとビートが俺の武器
音楽と言葉で作る完璧な仕組み`,type:"technical",rhymeScore:25,countersTo:["counter"]},{id:"C1",text:`そんな挑発じゃ俺は動じない
冷静にライムで返すのが俺のスタイル`,type:"counter",rhymeScore:15,countersTo:["attack"]},{id:"C2",text:`お前の攻撃は見透かした
今度は俺のターン、逆転開始だ`,type:"counter",rhymeScore:15,countersTo:["attack"]},{id:"C3",text:`弱い犬ほどよく吠える、俺は結果で語る
最後に笑うのは誰か、もうすぐ分かる`,type:"counter",rhymeScore:20,countersTo:["attack"]},{id:"D1",text:`これで決着、俺の勝利は確定
お前もよく頑張った、でも俺が上だ`,type:"closing",rhymeScore:10,countersTo:[]},{id:"D2",text:`4ターンかけて証明した、俺のスキルの高さ
次回があるならまた来い、今日は俺の勝ち`,type:"closing",rhymeScore:10,countersTo:[]},{id:"D3",text:`最後のライムで締めくくる、この勝負は俺のもの
観客も納得の結果だろう、お疲れ様でした`,type:"closing",rhymeScore:10,countersTo:[]}],u=90,c=6e4/u,d=50,y=100;class S extends n.Scene{gameState;beatTimer;nextBeatTime=0;playerLyrics=[];opponentLyrics=[];playerScoreText;opponentScoreText;turnText;feedbackText;opponentActionText;beatMarker;lyricsButtons=[];constructor(){super({key:"BattleScene"})}init(t){this.playerLyrics=t.selectedLyrics||h.slice(0,4),this.opponentLyrics=h.filter(s=>s.type==="attack"||s.type==="technical")}create(){this.gameState={currentTurn:1,playerScore:0,opponentScore:0,beatCount:0,gamePhase:"waiting",opponentLyric:null},this.add.text(400,30,"BATTLE START",{font:"32px Arial",color:"#ff0000"}).setOrigin(.5),this.playerScoreText=this.add.text(30,30,"YOU: 0",{font:"24px Arial",color:"#00ff00"}),this.opponentScoreText=this.add.text(770,30,"CPU: 0",{font:"24px Arial",color:"#ff0000"}).setOrigin(1,0),this.turnText=this.add.text(400,70,"Turn: 1/4",{font:"24px Arial",color:"#ffffff"}).setOrigin(.5),this.feedbackText=this.add.text(400,300,"",{font:"32px Arial",color:"#ffff00",align:"center"}).setOrigin(.5),this.opponentActionText=this.add.text(400,200,"",{font:"24px Arial",color:"#ff8888",align:"center"}).setOrigin(.5),this.beatMarker=this.add.text(400,120,"●",{font:"32px Arial",color:"#ffffff"}).setOrigin(.5).setVisible(!1),this.createLyricsButtons(),this.setupBeatTimer()}setupBeatTimer(){this.nextBeatTime=this.time.now,this.beatTimer=this.time.addEvent({delay:c,callback:this.onBeat,callbackScope:this,loop:!0})}onBeat(){this.gameState.beatCount++,this.nextBeatTime+=c,this.beatMarker.setVisible(!0),this.tweens.add({targets:this.beatMarker,alpha:0,duration:c/2,onComplete:()=>this.beatMarker.setAlpha(1).setVisible(!1)}),this.gameState.beatCount%8===1?this.opponentTurn():this.gameState.beatCount%8===5&&this.playerTurn()}opponentTurn(){this.gameState.gamePhase="waiting",this.toggleLyricsButtons(!1);const t=this.opponentLyrics[n.Math.Between(0,this.opponentLyrics.length-1)];this.gameState.opponentLyric=t;const i=(Math.random()>.2?50:30)+t.rhymeScore;this.gameState.opponentScore+=i,this.updateScoreDisplay(),this.opponentActionText.setText(`[CPU] ${t.text.replace(`
`," / ")}`),this.feedbackText.setText("")}playerTurn(){this.feedbackText.setText("YOUR TURN: SELECT!"),this.gameState.gamePhase="selecting",this.toggleLyricsButtons(!0)}createLyricsButtons(){this.playerLyrics.forEach((t,s)=>{const i=450+Math.floor(s/2)*60,e=250+s%2*300,r=this.add.text(e,i,t.text.replace(`
`," / "),{font:"16px Arial",color:"#ffffff",backgroundColor:"#333333",padding:{x:10,y:5}}).setOrigin(.5).setInteractive();r.on("pointerdown",()=>this.handlePlayerInput(t)),this.lyricsButtons.push(r)}),this.toggleLyricsButtons(!1)}handlePlayerInput(t){if(this.gameState.gamePhase!=="selecting")return;this.gameState.gamePhase="performing",this.toggleLyricsButtons(!1);const s=Math.abs(this.time.now-this.nextBeatTime);let i;s<=d?i={accuracy:"perfect",score:50}:s<=y?i={accuracy:"good",score:30}:i={accuracy:"miss",score:0};let e=0;this.gameState.opponentLyric&&t.countersTo.includes(this.gameState.opponentLyric.type)&&(e=50);const r=t.rhymeScore,o=i.score+e+r;this.gameState.playerScore+=o,this.updateScoreDisplay(),this.showFeedback(i,e,r),this.advanceTurn()}updateScoreDisplay(){this.playerScoreText.setText(`YOU: ${this.gameState.playerScore}`),this.opponentScoreText.setText(`CPU: ${this.gameState.opponentScore}`)}showFeedback(t,s,i){const e=`Rhythm: ${t.accuracy.toUpperCase()} +${t.score}
Choice: +${s}
Rhyme: +${i}`;this.feedbackText.setText(e),this.opponentActionText.setText("")}advanceTurn(){this.gameState.currentTurn<4?(this.gameState.currentTurn++,this.time.delayedCall(1500,()=>{this.turnText.setText(`Turn: ${this.gameState.currentTurn}/4`),this.feedbackText.setText("")})):this.time.delayedCall(2e3,()=>this.endBattle())}endBattle(){this.beatTimer.destroy(),this.gameState.gamePhase="result",this.feedbackText.setText(`FINISH!
Final Score: ${this.gameState.playerScore}`),this.time.delayedCall(3e3,()=>{this.scene.start("ResultScene",{playerScore:this.gameState.playerScore,opponentScore:this.gameState.opponentScore})})}toggleLyricsButtons(t){this.lyricsButtons.forEach(s=>{s.setInteractive(t).setAlpha(t?1:.5)})}}class g extends n.Scene{constructor(){super({key:"MainMenuScene"})}create(){this.add.text(400,250,"ラップバトルゲーム",{font:"48px Arial",color:"#ffffff"}).setOrigin(.5),this.add.text(400,350,"クリックして開始",{font:"32px Arial",color:"#ffffff"}).setOrigin(.5),this.input.on("pointerdown",()=>{this.scene.start("LyricsSelectScene")})}}class x extends n.Scene{selectedLyrics=[];startButton;lyricsContainer;scrollMinY=0;scrollMaxY=0;titleText;maskGraphics;constructor(){super({key:"LyricsSelectScene"})}create(){this.selectedLyrics=[],this.createLayout(),this.input.on("wheel",this.onWheel,this),this.scale.on("resize",this.onResize,this)}createLayout(){const{width:t,height:s}=this.scale;this.titleText&&this.titleText.destroy(),this.startButton&&this.startButton.destroy(),this.lyricsContainer&&this.lyricsContainer.destroy(),this.maskGraphics&&this.maskGraphics.destroy(),this.titleText=this.add.text(t*.5,50,"歌詞を4つ選択してください",{font:"32px Arial",color:"#ffffff"}).setOrigin(.5);const i=120,e=s-200;this.lyricsContainer=this.add.container(t*.5,i),this.renderLyrics(t),this.maskGraphics=this.make.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,i,t,e);const r=this.maskGraphics.createGeometryMask();this.lyricsContainer.setMask(r);const o=this.lyricsContainer.getData("contentHeight")||0;this.scrollMaxY=i,this.scrollMinY=i+e-o,o<e&&(this.scrollMinY=i),this.lyricsContainer.y=this.scrollMaxY,this.startButton=this.add.text(t*.5,s-60,"バトル開始",{font:"32px Arial",color:"#888888",backgroundColor:"#555555",padding:{x:10,y:5}}).setOrigin(.5),this.updateStartButtonState()}renderLyrics(t){let s=0;const i=t*.8;h.forEach(r=>{const o=this.add.text(0,s,`[${r.type}] ${r.text.replace(`
`," / ")}`,{font:"20px Arial",color:"#ffffff",backgroundColor:"#333333",padding:{x:10,y:10},wordWrap:{width:i}}).setOrigin(.5,0).setInteractive({useHandCursor:!0});o.on("pointerdown",()=>{this.toggleLyricSelection(r,o)}),this.lyricsContainer.add(o),s+=o.height+15});const e=s>0?s-15:0;this.lyricsContainer.setData("contentHeight",e)}onWheel(t,s,i,e){if(this.scrollMinY>=this.scrollMaxY)return;const r=this.lyricsContainer.y-e*.5;this.lyricsContainer.y=n.Math.Clamp(r,this.scrollMinY,this.scrollMaxY)}onResize(t){this.createLayout()}toggleLyricSelection(t,s){const i=this.selectedLyrics.findIndex(e=>e.id===t.id);i>-1?(this.selectedLyrics.splice(i,1),s.setBackgroundColor("#333333")):this.selectedLyrics.length<4&&(this.selectedLyrics.push(t),s.setBackgroundColor("#00ff00")),this.updateStartButtonState()}updateStartButtonState(){this.selectedLyrics.length===4?(this.startButton.setInteractive({useHandCursor:!0}),this.startButton.setColor("#ffffff"),this.startButton.setBackgroundColor("#008800"),this.startButton.off("pointerdown"),this.startButton.on("pointerdown",()=>{this.scale.off("resize",this.onResize,this),this.input.off("wheel",this.onWheel,this),this.scene.start("BattleScene",{selectedLyrics:this.selectedLyrics})})):(this.startButton.disableInteractive(),this.startButton.setColor("#888888"),this.startButton.setBackgroundColor("#555555"))}shutdown(){this.scale.off("resize",this.onResize,this),this.input.off("wheel",this.onWheel,this)}}class m extends n.Scene{playerScore=0;opponentScore=0;constructor(){super({key:"ResultScene"})}init(t){this.playerScore=t.playerScore||0,this.opponentScore=t.opponentScore||0}create(){let t,s;this.playerScore>this.opponentScore?(t="YOU WIN!",s="#00ff00"):this.playerScore<this.opponentScore?(t="YOU LOSE...",s="#ff0000"):(t="DRAW",s="#ffff00"),this.add.text(400,200,t,{font:"64px Arial",color:s}).setOrigin(.5),this.add.text(400,300,`Your Score: ${this.playerScore}`,{font:"32px Arial",color:"#ffffff"}).setOrigin(.5),this.add.text(400,350,`Opponent's Score: ${this.opponentScore}`,{font:"32px Arial",color:"#ffffff"}).setOrigin(.5),this.add.text(400,450,"Play Again",{font:"32px Arial",color:"#ffffff",backgroundColor:"#333333",padding:{x:10,y:5}}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.start("MainMenuScene")})}}const T={type:n.AUTO,scale:{mode:n.Scale.RESIZE,parent:"app",width:"100%",height:"100%"},scene:[g,x,S,m]};new n.Game(T);
