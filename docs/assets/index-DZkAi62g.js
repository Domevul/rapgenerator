import{r as f,g as m}from"./phaser-Czz4FBZH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();var E=f();const c=m(E),y=[{id:"A1",text:`俺のフロウは最強、ビートを支配する
お前のライムは弱小、勝負にならない`,type:"attack",rhymeScore:20,countersTo:["technical"]},{id:"A2",text:`ここは俺のステージ、お前は帰れ
実力の差を見せてやる、これが真のMC`,type:"attack",rhymeScore:25,countersTo:["technical"]},{id:"A3",text:`お前のスキルじゃ俺には勝てない
このバトルで証明する、俺がナンバーワン`,type:"attack",rhymeScore:20,countersTo:["technical"]},{id:"B1",text:`韻を踏むのは俺の専門、リズムも完璧
君のスタイルじゃこのバトル、勝利は不可能`,type:"technical",rhymeScore:30,countersTo:["counter"]},{id:"B2",text:`ワードプレイで魅せる俺のアート
メタファーとライムで編む最高のパート`,type:"technical",rhymeScore:30,countersTo:["counter"]},{id:"B3",text:`フロウとビートが俺の武器
音楽と言葉で作る完璧な仕組み`,type:"technical",rhymeScore:25,countersTo:["counter"]},{id:"C1",text:`そんな挑発じゃ俺は動じない
冷静にライムで返すのが俺のスタイル`,type:"counter",rhymeScore:15,countersTo:["attack"]},{id:"C2",text:`お前の攻撃は見透かした
今度は俺のターン、逆転開始だ`,type:"counter",rhymeScore:15,countersTo:["attack"]},{id:"C3",text:`弱い犬ほどよく吠える、俺は結果で語る
最後に笑うのは誰か、もうすぐ分かる`,type:"counter",rhymeScore:20,countersTo:["attack"]},{id:"D1",text:`これで決着、俺の勝利は確定
お前もよく頑張った、でも俺が上だ`,type:"closing",rhymeScore:10,countersTo:[]},{id:"D2",text:`4ターンかけて証明した、俺のスキルの高さ
次回があるならまた来い、今日は俺の勝ち`,type:"closing",rhymeScore:10,countersTo:[]},{id:"D3",text:`最後のライムで締めくくる、この勝負は俺のもの
観客も納得の結果だろう、お疲れ様でした`,type:"closing",rhymeScore:10,countersTo:[]}],x=90,T=6e4/x,L=50,R=100,l={PRELOADER:"PreloaderScene",MAIN_MENU:"MainMenuScene",LYRICS_SELECT:"LyricsSelectScene",BATTLE:"BattleScene",RESULT:"ResultScene"},r={WHITE:"#ffffff",GREY:"#888888",DARK_GREY:"#333333",GREEN:"#00ff00",RED:"#ff0000",YELLOW:"#ffff00",PRIMARY:"#008800",SECONDARY:"#555555",TERTIARY:"#ff8888"},n={TITLE:{font:'72px "Noto Sans JP", Arial, sans-serif',color:r.WHITE},SUBTITLE:{font:'48px "Noto Sans JP", Arial, sans-serif',color:r.WHITE},BODY:{font:'36px "Noto Sans JP", Arial, sans-serif',color:r.WHITE},BUTTON:{font:'48px "Noto Sans JP", Arial, sans-serif',color:r.GREY,backgroundColor:r.SECONDARY,padding:{x:15,y:8}},LYRIC_TEXT:{font:'30px "Noto Sans JP", Arial, sans-serif',color:r.WHITE,backgroundColor:r.DARK_GREY,padding:{x:15,y:15}},BATTLE_FEEDBACK:{font:'48px "Noto Sans JP", Arial, sans-serif',color:r.YELLOW,align:"center"},BATTLE_OPPONENT_ACTION:{font:'36px "Noto Sans JP", Arial, sans-serif',color:r.TERTIARY,align:"center"},RESULT_WIN:{font:'96px "Noto Sans JP", Arial, sans-serif',color:r.GREEN},RESULT_LOSE:{font:'96px "Noto Sans JP", Arial, sans-serif',color:r.RED},RESULT_DRAW:{font:'96px "Noto Sans JP", Arial, sans-serif',color:r.YELLOW}};class B extends c.Scene{gameState;beatTimer;nextBeatTime=0;playerLyrics=[];opponentLyrics=[];backgroundMusic;uiElements=[];constructor(){super({key:l.BATTLE})}init(t){this.playerLyrics=t.selectedLyrics||y.slice(0,4),this.opponentLyrics=y.filter(e=>e.type==="attack"||e.type==="technical")}create(){this.gameState={currentTurn:1,playerScore:0,opponentScore:0,beatCount:0,gamePhase:"waiting",opponentLyric:null},this.createLayout(),this.setupBeatTimer(),this.scale.on("resize",this.onResize,this)}onResize(){this.createLayout()}createLayout(){this.uiElements.forEach(g=>g.destroy()),this.uiElements=[];const{width:t,height:e}=this.scale,i=e*.05,s=t*.05;this.uiElements.push(this.add.text(t*.5,i,"BATTLE START",{...n.SUBTITLE,color:r.RED}).setOrigin(.5));const o=this.add.text(s,i,`YOU: ${this.gameState.playerScore}`,{...n.BODY,color:r.GREEN}).setOrigin(0,.5),a=this.add.text(t-s,i,`CPU: ${this.gameState.opponentScore}`,{...n.BODY,color:r.RED}).setOrigin(1,.5),h=this.add.text(t*.5,i+40,`Turn: ${this.gameState.currentTurn}/4`,n.BODY).setOrigin(.5);this.uiElements.push(o,a,h);const u=this.add.text(t*.5,e*.3,"",n.BATTLE_OPPONENT_ACTION).setOrigin(.5),p=this.add.text(t*.5,e*.45,"",n.BATTLE_FEEDBACK).setOrigin(.5),S=this.add.text(t*.5,e*.2,"●",n.SUBTITLE).setOrigin(.5).setVisible(!1);this.uiElements.push(u,p,S),this.data.set("playerScoreText",o),this.data.set("opponentScoreText",a),this.data.set("turnText",h),this.data.set("opponentActionText",u),this.data.set("feedbackText",p),this.data.set("beatMarker",S),(!this.backgroundMusic||!this.backgroundMusic.isPlaying)&&(this.backgroundMusic=this.sound.add("battle-music",{loop:!0}),this.backgroundMusic.play()),this.createLyricsButtons(),this.updateScoreDisplay()}setupBeatTimer(){this.nextBeatTime=this.time.now,this.beatTimer&&this.beatTimer.destroy(),this.beatTimer=this.time.addEvent({delay:T,callback:this.onBeat,callbackScope:this,loop:!0})}onBeat(){this.gameState.beatCount++,this.nextBeatTime+=T;const t=this.data.get("beatMarker");t&&t.scene&&(t.setVisible(!0),this.tweens.add({targets:t,alpha:0,duration:T/2,onComplete:()=>t.setAlpha(1).setVisible(!1)})),this.gameState.beatCount%8===1?this.opponentTurn():this.gameState.beatCount%8===5&&this.playerTurn()}opponentTurn(){this.gameState.gamePhase="waiting",this.toggleLyricsButtons(!1);const t=this.opponentLyrics[c.Math.Between(0,this.opponentLyrics.length-1)];this.gameState.opponentLyric=t;const i=(Math.random()>.2?50:30)+t.rhymeScore;this.gameState.opponentScore+=i,this.updateScoreDisplay(),this.data.get("opponentActionText").setText(`[CPU] ${t.text.replace(`
`," / ")}`),this.data.get("feedbackText").setText("")}playerTurn(){this.data.get("feedbackText").setText("YOUR TURN: SELECT!"),this.gameState.gamePhase="selecting",this.toggleLyricsButtons(!0)}createLyricsButtons(){const{width:t,height:e}=this.scale,i={...n.LYRIC_TEXT,font:"16px Arial",padding:{x:10,y:5},wordWrap:{width:t*.8}},s=e>t;this.playerLyrics.forEach((o,a)=>{let h,u;s?(h=t*.5,u=e*.65+a*60):(h=t*.3+a%2*(t*.4),u=e*.7+Math.floor(a/2)*70);const p=this.add.text(h,u,o.text.replace(`
`," / "),i).setOrigin(.5).setInteractive();p.on("pointerdown",()=>this.handlePlayerInput(o)),this.uiElements.push(p),this.data.get("lyricsButtons").push(p)}),this.data.set("lyricsButtons",[]),this.toggleLyricsButtons(this.gameState.gamePhase==="selecting")}handlePlayerInput(t){if(this.gameState.gamePhase!=="selecting")return;this.gameState.gamePhase="performing",this.toggleLyricsButtons(!1);const e=Math.abs(this.time.now-this.nextBeatTime);let i;e<=L?i={accuracy:"perfect",score:50}:e<=R?i={accuracy:"good",score:30}:i={accuracy:"miss",score:0};let s=0;this.gameState.opponentLyric&&t.countersTo.includes(this.gameState.opponentLyric.type)&&(s=50);const o=t.rhymeScore,a=i.score+s+o;this.gameState.playerScore+=a,this.updateScoreDisplay(),this.showFeedback(i,s,o),this.advanceTurn()}updateScoreDisplay(){this.data.get("playerScoreText").setText(`YOU: ${this.gameState.playerScore}`),this.data.get("opponentScoreText").setText(`CPU: ${this.gameState.opponentScore}`)}showFeedback(t,e,i){const s=`Rhythm: ${t.accuracy.toUpperCase()} +${t.score}
Choice: +${e}
Rhyme: +${i}`;this.data.get("feedbackText").setText(s),this.data.get("opponentActionText").setText("")}advanceTurn(){this.gameState.currentTurn<4?(this.gameState.currentTurn++,this.time.delayedCall(1500,()=>{this.data.get("turnText").setText(`Turn: ${this.gameState.currentTurn}/4`),this.data.get("feedbackText").setText("")})):this.time.delayedCall(2e3,()=>this.endBattle())}endBattle(){this.backgroundMusic.stop(),this.beatTimer.destroy(),this.gameState.gamePhase="result",this.data.get("feedbackText").setText(`FINISH!
Final Score: ${this.gameState.playerScore}`),this.time.delayedCall(3e3,()=>{this.scene.start(l.RESULT,{playerScore:this.gameState.playerScore,opponentScore:this.gameState.opponentScore})})}toggleLyricsButtons(t){(this.data.get("lyricsButtons")||[]).forEach(i=>{i&&i.scene&&i.setInteractive(t).setAlpha(t?1:.5)})}shutdown(){this.scale.off("resize",this.onResize,this),this.beatTimer&&this.beatTimer.destroy(),this.backgroundMusic&&(this.backgroundMusic.stop(),this.backgroundMusic.destroy())}}class C extends c.Scene{uiElements=[];constructor(){super({key:l.MAIN_MENU})}create(){this.createLayout(),this.scale.on("resize",this.onResize,this),this.input.once("pointerdown",()=>{this.scene.start(l.LYRICS_SELECT)})}onResize(){this.createLayout()}createLayout(){this.uiElements.forEach(o=>o.destroy()),this.uiElements=[];const{width:t,height:e}=this.scale,i=this.add.text(t*.5,e*.4,"ラップバトルゲーム",n.TITLE).setOrigin(.5),s=this.add.text(t*.5,e*.6,"クリックして開始",n.SUBTITLE).setOrigin(.5);this.uiElements.push(i,s)}shutdown(){this.scale.off("resize",this.onResize,this)}}class A extends c.Scene{selectedLyrics=[];startButton;lyricsContainer;scrollMinY=0;scrollMaxY=0;titleText;maskGraphics;constructor(){super({key:l.LYRICS_SELECT})}create(){this.selectedLyrics=[],this.createLayout(),this.input.on("wheel",this.onWheel,this),this.scale.on("resize",this.onResize,this)}onResize(){this.createLayout()}createLayout(){this.titleText&&this.titleText.destroy(),this.lyricsContainer&&this.lyricsContainer.destroy(),this.startButton&&this.startButton.destroy(),this.maskGraphics&&this.maskGraphics.destroy();const{width:t,height:e}=this.scale;this.titleText=this.add.text(t*.5,50,"歌詞を4つ選択してください",n.SUBTITLE).setOrigin(.5);const i=120,s=e-200;this.lyricsContainer=this.add.container(t*.5,i),this.renderLyrics(t),this.maskGraphics=this.make.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect((t-t*.8)/2,i,t*.8,s);const o=this.maskGraphics.createGeometryMask();this.lyricsContainer.setMask(o);const a=this.lyricsContainer.getData("contentHeight")||0;this.scrollMaxY=i,this.scrollMinY=i+s-a,a<s&&(this.scrollMinY=i),this.lyricsContainer.y=c.Math.Clamp(this.lyricsContainer.y,this.scrollMinY,this.scrollMaxY),this.startButton=this.add.text(t*.5,e-60,"バトル開始",n.BUTTON).setOrigin(.5),this.updateStartButtonState()}renderLyrics(t){this.lyricsContainer.removeAll(!0);let e=0;const i=t*.8;y.forEach(o=>{const a={...n.LYRIC_TEXT,wordWrap:{width:i}},h=this.add.text(0,e,`[${o.type}] ${o.text.replace(`
`," / ")}`,a).setOrigin(.5,0).setInteractive({useHandCursor:!0});this.selectedLyrics.some(u=>u.id===o.id)&&h.setBackgroundColor(r.GREEN),h.on("pointerdown",()=>{this.toggleLyricSelection(o,h)}),this.lyricsContainer.add(h),e+=h.height+15});const s=e>0?e-15:0;this.lyricsContainer.setData("contentHeight",s)}onWheel(t,e,i,s){if(this.scrollMinY>=this.scrollMaxY)return;const o=this.lyricsContainer.y-s*.5;this.lyricsContainer.y=c.Math.Clamp(o,this.scrollMinY,this.scrollMaxY)}toggleLyricSelection(t,e){const i=this.selectedLyrics.findIndex(s=>s.id===t.id);i>-1?(this.selectedLyrics.splice(i,1),e.setBackgroundColor(r.DARK_GREY)):this.selectedLyrics.length<4&&(this.selectedLyrics.push(t),e.setBackgroundColor(r.GREEN)),this.updateStartButtonState()}updateStartButtonState(){this.selectedLyrics.length===4?(this.startButton.setInteractive({useHandCursor:!0}),this.startButton.setColor(r.WHITE),this.startButton.setBackgroundColor(r.PRIMARY),this.startButton.off("pointerdown"),this.startButton.on("pointerdown",()=>{this.scene.start(l.BATTLE,{selectedLyrics:this.selectedLyrics})})):(this.startButton.disableInteractive(),this.startButton.setColor(r.GREY),this.startButton.setBackgroundColor(r.SECONDARY))}shutdown(){this.input.off("wheel",this.onWheel,this),this.scale.off("resize",this.onResize,this)}}class O extends c.GameObjects.Container{buttonText;constructor(t,e,i,s,o){super(t,e,i);const a={...n.BUTTON,color:"#ffffff",backgroundColor:"#333333"};this.buttonText=t.add.text(0,0,s,a).setOrigin(.5),this.add(this.buttonText),this.setSize(this.buttonText.width,this.buttonText.height),this.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.buttonText.setAlpha(.7)}).on("pointerup",()=>{this.buttonText.setAlpha(1),o()}).on("pointerout",()=>{this.buttonText.setAlpha(1)}),t.add.existing(this)}}class b extends c.Scene{playerScore=0;opponentScore=0;constructor(){super({key:l.RESULT})}init(t){this.playerScore=t.playerScore||0,this.opponentScore=t.opponentScore||0}create(){let t,e;this.playerScore>this.opponentScore?(t="YOU WIN!",e=n.RESULT_WIN):this.playerScore<this.opponentScore?(t="YOU LOSE...",e=n.RESULT_LOSE):(t="DRAW",e=n.RESULT_DRAW),this.add.text(400,200,t,e).setOrigin(.5),this.add.text(400,300,`Your Score: ${this.playerScore}`,n.SUBTITLE).setOrigin(.5),this.add.text(400,350,`Opponent's Score: ${this.opponentScore}`,n.SUBTITLE).setOrigin(.5),new O(this,400,450,"Play Again",()=>{this.scene.start(l.MAIN_MENU)})}}class I extends c.Scene{constructor(){super({key:l.PRELOADER})}preload(){this.load.audio("battle-music","assets/battle-music.mp3")}create(){const{width:t,height:e}=this.scale;this.add.text(t/2,e/2,"Loading...",n.TITLE).setOrigin(.5),this.scene.start(l.MAIN_MENU)}}const M={type:c.AUTO,scale:{parent:"app",mode:c.Scale.RESIZE,autoCenter:c.Scale.CENTER_BOTH,width:"100%",height:"100%"},scene:[I,C,A,B,b]};new c.Game(M);
