import{r as d,g as T}from"./phaser-Czz4FBZH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();var S=d();const c=T(S),u=[{id:"A1",text:`俺のフロウは最強、ビートを支配する
お前のライムは弱小、勝負にならない`,type:"attack",rhymeScore:20,countersTo:["technical"]},{id:"A2",text:`ここは俺のステージ、お前は帰れ
実力の差を見せてやる、これが真のMC`,type:"attack",rhymeScore:25,countersTo:["technical"]},{id:"A3",text:`お前のスキルじゃ俺には勝てない
このバトルで証明する、俺がナンバーワン`,type:"attack",rhymeScore:20,countersTo:["technical"]},{id:"B1",text:`韻を踏むのは俺の専門、リズムも完璧
君のスタイルじゃこのバトル、勝利は不可能`,type:"technical",rhymeScore:30,countersTo:["counter"]},{id:"B2",text:`ワードプレイで魅せる俺のアート
メタファーとライムで編む最高のパート`,type:"technical",rhymeScore:30,countersTo:["counter"]},{id:"B3",text:`フロウとビートが俺の武器
音楽と言葉で作る完璧な仕組み`,type:"technical",rhymeScore:25,countersTo:["counter"]},{id:"C1",text:`そんな挑発じゃ俺は動じない
冷静にライムで返すのが俺のスタイル`,type:"counter",rhymeScore:15,countersTo:["attack"]},{id:"C2",text:`お前の攻撃は見透かした
今度は俺のターン、逆転開始だ`,type:"counter",rhymeScore:15,countersTo:["attack"]},{id:"C3",text:`弱い犬ほどよく吠える、俺は結果で語る
最後に笑うのは誰か、もうすぐ分かる`,type:"counter",rhymeScore:20,countersTo:["attack"]},{id:"D1",text:`これで決着、俺の勝利は確定
お前もよく頑張った、でも俺が上だ`,type:"closing",rhymeScore:10,countersTo:[]},{id:"D2",text:`4ターンかけて証明した、俺のスキルの高さ
次回があるならまた来い、今日は俺の勝ち`,type:"closing",rhymeScore:10,countersTo:[]},{id:"D3",text:`最後のライムで締めくくる、この勝負は俺のもの
観客も納得の結果だろう、お疲れ様でした`,type:"closing",rhymeScore:10,countersTo:[]}],y=90,p=6e4/y,f=50,g=100,h={PRELOADER:"PreloaderScene",MAIN_MENU:"MainMenuScene",LYRICS_SELECT:"LyricsSelectScene",BATTLE:"BattleScene",RESULT:"ResultScene"},r={WHITE:"#ffffff",GREY:"#888888",DARK_GREY:"#333333",GREEN:"#00ff00",RED:"#ff0000",YELLOW:"#ffff00",PRIMARY:"#008800",SECONDARY:"#555555",TERTIARY:"#ff8888"},n={TITLE:{font:"48px Arial",color:r.WHITE},SUBTITLE:{font:"32px Arial",color:r.WHITE},BODY:{font:"24px Arial",color:r.WHITE},BUTTON:{font:"32px Arial",color:r.GREY,backgroundColor:r.SECONDARY,padding:{x:10,y:5}},LYRIC_TEXT:{font:"20px Arial",color:r.WHITE,backgroundColor:r.DARK_GREY,padding:{x:10,y:10}},BATTLE_FEEDBACK:{font:"32px Arial",color:r.YELLOW,align:"center"},BATTLE_OPPONENT_ACTION:{font:"24px Arial",color:r.TERTIARY,align:"center"},RESULT_WIN:{font:"64px Arial",color:r.GREEN},RESULT_LOSE:{font:"64px Arial",color:r.RED},RESULT_DRAW:{font:"64px Arial",color:r.YELLOW}};class x extends c.Scene{gameState;beatTimer;nextBeatTime=0;playerLyrics=[];opponentLyrics=[];playerScoreText;opponentScoreText;turnText;feedbackText;opponentActionText;beatMarker;lyricsButtons=[];constructor(){super({key:h.BATTLE})}init(t){this.playerLyrics=t.selectedLyrics||u.slice(0,4),this.opponentLyrics=u.filter(s=>s.type==="attack"||s.type==="technical")}create(){this.gameState={currentTurn:1,playerScore:0,opponentScore:0,beatCount:0,gamePhase:"waiting",opponentLyric:null},this.add.text(400,30,"BATTLE START",{...n.SUBTITLE,color:r.RED}).setOrigin(.5),this.playerScoreText=this.add.text(30,30,"YOU: 0",{...n.BODY,color:r.GREEN}),this.opponentScoreText=this.add.text(770,30,"CPU: 0",{...n.BODY,color:r.RED}).setOrigin(1,0),this.turnText=this.add.text(400,70,"Turn: 1/4",n.BODY).setOrigin(.5),this.feedbackText=this.add.text(400,300,"",n.BATTLE_FEEDBACK).setOrigin(.5),this.opponentActionText=this.add.text(400,200,"",n.BATTLE_OPPONENT_ACTION).setOrigin(.5),this.beatMarker=this.add.text(400,120,"●",n.SUBTITLE).setOrigin(.5).setVisible(!1),this.createLyricsButtons(),this.setupBeatTimer()}setupBeatTimer(){this.nextBeatTime=this.time.now,this.beatTimer=this.time.addEvent({delay:p,callback:this.onBeat,callbackScope:this,loop:!0})}onBeat(){this.gameState.beatCount++,this.nextBeatTime+=p,this.beatMarker.setVisible(!0),this.tweens.add({targets:this.beatMarker,alpha:0,duration:p/2,onComplete:()=>this.beatMarker.setAlpha(1).setVisible(!1)}),this.gameState.beatCount%8===1?this.opponentTurn():this.gameState.beatCount%8===5&&this.playerTurn()}opponentTurn(){this.gameState.gamePhase="waiting",this.toggleLyricsButtons(!1);const t=this.opponentLyrics[c.Math.Between(0,this.opponentLyrics.length-1)];this.gameState.opponentLyric=t;const i=(Math.random()>.2?50:30)+t.rhymeScore;this.gameState.opponentScore+=i,this.updateScoreDisplay(),this.opponentActionText.setText(`[CPU] ${t.text.replace(`
`," / ")}`),this.feedbackText.setText("")}playerTurn(){this.feedbackText.setText("YOUR TURN: SELECT!"),this.gameState.gamePhase="selecting",this.toggleLyricsButtons(!0)}createLyricsButtons(){this.playerLyrics.forEach((t,s)=>{const i=450+Math.floor(s/2)*60,e=250+s%2*300,o={...n.LYRIC_TEXT,font:"16px Arial",padding:{x:10,y:5}},a=this.add.text(e,i,t.text.replace(`
`," / "),o).setOrigin(.5).setInteractive();a.on("pointerdown",()=>this.handlePlayerInput(t)),this.lyricsButtons.push(a)}),this.toggleLyricsButtons(!1)}handlePlayerInput(t){if(this.gameState.gamePhase!=="selecting")return;this.gameState.gamePhase="performing",this.toggleLyricsButtons(!1);const s=Math.abs(this.time.now-this.nextBeatTime);let i;s<=f?i={accuracy:"perfect",score:50}:s<=g?i={accuracy:"good",score:30}:i={accuracy:"miss",score:0};let e=0;this.gameState.opponentLyric&&t.countersTo.includes(this.gameState.opponentLyric.type)&&(e=50);const o=t.rhymeScore,a=i.score+e+o;this.gameState.playerScore+=a,this.updateScoreDisplay(),this.showFeedback(i,e,o),this.advanceTurn()}updateScoreDisplay(){this.playerScoreText.setText(`YOU: ${this.gameState.playerScore}`),this.opponentScoreText.setText(`CPU: ${this.gameState.opponentScore}`)}showFeedback(t,s,i){const e=`Rhythm: ${t.accuracy.toUpperCase()} +${t.score}
Choice: +${s}
Rhyme: +${i}`;this.feedbackText.setText(e),this.opponentActionText.setText("")}advanceTurn(){this.gameState.currentTurn<4?(this.gameState.currentTurn++,this.time.delayedCall(1500,()=>{this.turnText.setText(`Turn: ${this.gameState.currentTurn}/4`),this.feedbackText.setText("")})):this.time.delayedCall(2e3,()=>this.endBattle())}endBattle(){this.beatTimer.destroy(),this.gameState.gamePhase="result",this.feedbackText.setText(`FINISH!
Final Score: ${this.gameState.playerScore}`),this.time.delayedCall(3e3,()=>{this.scene.start(h.RESULT,{playerScore:this.gameState.playerScore,opponentScore:this.gameState.opponentScore})})}toggleLyricsButtons(t){this.lyricsButtons.forEach(s=>{s.setInteractive(t).setAlpha(t?1:.5)})}}class E extends c.Scene{constructor(){super({key:h.MAIN_MENU})}create(){this.add.text(400,250,"ラップバトルゲーム",n.TITLE).setOrigin(.5),this.add.text(400,350,"クリックして開始",n.SUBTITLE).setOrigin(.5),this.input.on("pointerdown",()=>{this.scene.start(h.LYRICS_SELECT)})}}class m extends c.Scene{selectedLyrics=[];startButton;lyricsContainer;scrollMinY=0;scrollMaxY=0;titleText;maskGraphics;constructor(){super({key:h.LYRICS_SELECT})}create(){this.selectedLyrics=[],this.createLayout(),this.input.on("wheel",this.onWheel,this),this.scale.on("resize",this.onResize,this)}createLayout(){const{width:t,height:s}=this.scale;this.titleText&&this.titleText.destroy(),this.startButton&&this.startButton.destroy(),this.lyricsContainer&&this.lyricsContainer.destroy(),this.maskGraphics&&this.maskGraphics.destroy(),this.titleText=this.add.text(t*.5,50,"歌詞を4つ選択してください",n.SUBTITLE).setOrigin(.5);const i=120,e=s-200;this.lyricsContainer=this.add.container(t*.5,i),this.renderLyrics(t),this.maskGraphics=this.make.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,i,t,e);const o=this.maskGraphics.createGeometryMask();this.lyricsContainer.setMask(o);const a=this.lyricsContainer.getBounds().height;this.scrollMaxY=i,this.scrollMinY=i+e-a,a<e&&(this.scrollMinY=i),this.lyricsContainer.y=this.scrollMaxY,this.startButton=this.add.text(t*.5,s-60,"バトル開始",n.BUTTON).setOrigin(.5),this.updateStartButtonState()}renderLyrics(t){let s=0;const i=t*.8;u.forEach(e=>{const o={...n.LYRIC_TEXT,wordWrap:{width:i}},a=this.add.text(0,s,`[${e.type}] ${e.text.replace(`
`," / ")}`,o).setOrigin(.5,0).setInteractive({useHandCursor:!0});a.on("pointerdown",()=>{this.toggleLyricSelection(e,a)}),this.lyricsContainer.add(a),s+=a.height+15})}onWheel(t,s,i,e){if(this.scrollMinY>=this.scrollMaxY)return;const o=this.lyricsContainer.y-e*.5;this.lyricsContainer.y=c.Math.Clamp(o,this.scrollMinY,this.scrollMaxY)}onResize(t){this.createLayout()}toggleLyricSelection(t,s){const i=this.selectedLyrics.findIndex(e=>e.id===t.id);i>-1?(this.selectedLyrics.splice(i,1),s.setBackgroundColor(r.DARK_GREY)):this.selectedLyrics.length<4&&(this.selectedLyrics.push(t),s.setBackgroundColor(r.GREEN)),this.updateStartButtonState()}updateStartButtonState(){this.selectedLyrics.length===4?(this.startButton.setInteractive({useHandCursor:!0}),this.startButton.setColor(r.WHITE),this.startButton.setBackgroundColor(r.PRIMARY),this.startButton.off("pointerdown"),this.startButton.on("pointerdown",()=>{this.scale.off("resize",this.onResize,this),this.input.off("wheel",this.onWheel,this),this.scene.start(h.BATTLE,{selectedLyrics:this.selectedLyrics})})):(this.startButton.disableInteractive(),this.startButton.setColor(r.GREY),this.startButton.setBackgroundColor(r.SECONDARY))}shutdown(){this.scale.off("resize",this.onResize,this),this.input.off("wheel",this.onWheel,this)}}class L extends c.GameObjects.Container{buttonText;constructor(t,s,i,e,o){super(t,s,i);const a={...n.BUTTON,color:"#ffffff",backgroundColor:"#333333"};this.buttonText=t.add.text(0,0,e,a).setOrigin(.5),this.add(this.buttonText),this.setSize(this.buttonText.width,this.buttonText.height),this.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.buttonText.setAlpha(.7)}).on("pointerup",()=>{this.buttonText.setAlpha(1),o()}).on("pointerout",()=>{this.buttonText.setAlpha(1)}),t.add.existing(this)}}class B extends c.Scene{playerScore=0;opponentScore=0;constructor(){super({key:h.RESULT})}init(t){this.playerScore=t.playerScore||0,this.opponentScore=t.opponentScore||0}create(){let t,s;this.playerScore>this.opponentScore?(t="YOU WIN!",s=n.RESULT_WIN):this.playerScore<this.opponentScore?(t="YOU LOSE...",s=n.RESULT_LOSE):(t="DRAW",s=n.RESULT_DRAW),this.add.text(400,200,t,s).setOrigin(.5),this.add.text(400,300,`Your Score: ${this.playerScore}`,n.SUBTITLE).setOrigin(.5),this.add.text(400,350,`Opponent's Score: ${this.opponentScore}`,n.SUBTITLE).setOrigin(.5),new L(this,400,450,"Play Again",()=>{this.scene.start(h.MAIN_MENU)})}}class R extends c.Scene{constructor(){super({key:h.PRELOADER})}preload(){}create(){const{width:t,height:s}=this.scale;this.add.text(t/2,s/2,"Loading...",n.TITLE).setOrigin(.5),this.scene.start(h.MAIN_MENU)}}const A={type:c.AUTO,scale:{mode:c.Scale.RESIZE,parent:"app",width:"100%",height:"100%"},scene:[R,E,m,x,B]};new c.Game(A);
